# Автоматическое выравнивание изображений документов

Этот проект предназначен для автоматического выравнивания изображений документов, содержащих печатный текст и графику. Алгоритм определяет угол наклона документа и поворачивает изображение так, чтобы текст был выровнен по горизонтали.

## Описание алгоритма

1. **Предобработка изображения**: 
   - Изображение преобразуется в градации серого с помощью `cv2.cvtColor`.
   - Для выделения границ используется детектор краев Canny (`cv2.Canny`).

2. **Обнаружение линий**: 
   - Используется преобразование Хафа (`cv2.HoughLinesP`) для обнаружения прямых линий на изображении. Этот метод хорошо подходит для обнаружения линий в документах, так как текст и графика часто образуют четкие границы.

3. **Определение угла поворота**: 
   - Для каждой обнаруженной линии вычисляется угол наклона с помощью `math.atan2`.
   - Углы фильтруются в диапазоне от -60 до +60 градусов, чтобы исключить нерелевантные линии.
   - Для определения итогового угла поворота используется медиана углов, что делает алгоритм устойчивым к выбросам.

4. **Поворот изображения**: 
   - Изображение поворачивается на вычисленный угол с использованием аффинного преобразования (`cv2.warpAffine`).
   - Учитывается масштабирование, чтобы избежать потери информации и обрезать лишнее пространство.

## Обоснование предложенного решения

### 1. **Выбор алгоритмов**
- **Детектор краев Canny**:
  - Сложность: O(n), где n = w * h — количество пикселей в изображении (w — ширина, h — высота).
  - Выбран для выделения границ текста и графики благодаря своей эффективности и точности. Существенно повышает точность поиска линиц на изображении.

- **Преобразование Хафа (HoughLinesP)**:
  - Сложность: O(n * k) = O(n), где n = w * h — количество пикселей, k - дискретизация угла (фиксированное число).

- **Медиана углов**:
  - Сложность: O(m log m), где m — количество обнаруженных линий.
  - Устойчива к выбросам, что важно для игнорирования линий, не связанных с текстом.

- **Аффинное преобразование (warpAffine)**:
  - Сложность: O(n), где n = w * h — количество пикселей.

### 2. **Использование памяти**
- Основные затраты:
  - Хранение изображения: O(n), где n = w * h.
  - Промежуточные данные (границы Canny, линии Хафа): O(n) и O(m) соответственно (m — количество обнаруженных линий).

### 3. **Преимущества и ограничения алгоритма**
- **Преимущества**:
  - Точность: Устойчивость к шуму благодаря использованию медианы на этапе подсчета угла.
  - Эффективность: Линейная сложность на всех этапах.
  - Простота: Минимальные настройки и легкость адаптации.
- **Ограничения**:
  - Зависимость от качества изображения: Сильный шум или отсутствие линий снижают точность.
  - Большая константа в O(n) алгоритма `HoughLinesP`.
  - Ограничение на угол поворота: Алгоритм рассчитан на углы от -60 до +60 градусов.

## Структура проекта
    project/
    ├── files/
    │   ├── example.jpg
    │   ├── example_rotated.jpg
    │   ├── TCGAN_page-0001.jpg              # Страница статьи TCGAN
    │   ├── TCGAN_page-0002.jpg              # Страница статьи TCGAN
    │   ├── TCGAN_page-0010.jpg              # Страница статьи TCGAN
    │   └── TCGAN_page-0014.jpg              # Страница статьи TCGAN
    ├── results/
    │   └── result.jpg                       # Результат коррекции поворота изображения из примера
    ├── tests/                               # Тестовые изображения с разными углами поворота
    │   └── {filename}_rotated_{angle}.jpg   # Пример: TCGAN_page-0001_rotated_15.jpg
    ├── autorotate.py                        # Основной скрипт для автоматического поворота
    ├── README.md                            # Документация проекта
    ├── requirements.txt                     # Зависимости проекта
    └── tests_generator.py                   # Скрипт для генерации тестовых изображений


## Использование

1. Установите зависимости:
    ```bash
    pip install -r requirements.txt
    ```

2. Импортируйте файл `autorotate.py` и используйте его следующим образом
    ```python
    from autorotate import ImageAutoRotator

    processor = ImageAutoRotator()
    rotated_image = processor.autorotate("document.jpg", "rotated_document.jpg")
    ```

3. Генерация тестовых изображений
    ```bash
    python tests_generator.py
    ```

4. Запуск скрипта
    ```bash
    python autorotate.py
    ```

    Выведет в консоль угол поворота документа из примера и MAE (Mean Absolute Error) на 5 тестовых изображениях документов в градусах.
    Кроме того, в папку results будет сохранен результат коррекции поворота документа из примера.

    MSE на 5 тестовых изображениях составляет 0.016691000216810793 градуса.

## Лицензия
Для оценки точности алгоритма проведено тестирование на нескольких изображениях с разными углами поворота. В качестве тестовых данных использовались страницы статьи ["TCGAN: Convolutional Generative Adversarial Network for Time Series Classification and Clustering"](https://arxiv.org/abs/2309.04732) Fanling Huang и Yangdong Deng с сайта ArXiv, распространяемой под лицензией CC BY 4.0.

Этот проект распространяется под лицензией MIT.
